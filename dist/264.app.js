"use strict";(self.webpackChunkbabylonjs=self.webpackChunkbabylonjs||[]).push([[264],{264:(e,t,s)=>{s.r(t),s.d(t,{Turret:()=>r});var i=s(630),o=s(864);class a{constructor(e,t,s,i){this.damageValue=5,this.scene=e,this.targetMesh=s,this.speed=i,e.isPhysicsEnabled()||(console.warn("⚠️ La physique n'est pas activée dans la scène. Activation en cours..."),e.enablePhysics(new BABYLON.Vector3(0,0,0),new BABYLON.CannonJSPlugin)),o.l.loadModel(e,"star_yellow",(s=>{this.mesh=s.meshes[0],this.mesh.position=t,this.mesh.scaling=new BABYLON.Vector3(3,3,3),this.mesh.physicsImpostor=new BABYLON.PhysicsImpostor(this.mesh,BABYLON.PhysicsImpostor.SphereImpostor,{mass:1,restitution:.1},e),this.addParticleEffect(),this.moveToTarget()}))}addParticleEffect(){const e=new BABYLON.ParticleSystem("projectileTrail",200,this.scene);e.particleTexture=new BABYLON.Texture("textures/flare.png",this.scene),e.emitter=this.mesh,e.minEmitBox=new BABYLON.Vector3(-.1,-.1,-.1),e.maxEmitBox=new BABYLON.Vector3(.1,.1,.1),e.color1=new BABYLON.Color4(1,1,0,1),e.color2=new BABYLON.Color4(1,.5,0,1),e.minSize=.1,e.maxSize=.3,e.minLifeTime=.2,e.maxLifeTime=.5,e.emitRate=100,e.blendMode=BABYLON.ParticleSystem.BLENDMODE_ONEONE,e.gravity=new BABYLON.Vector3(0,0,0),e.direction1=new BABYLON.Vector3(-.5,-.5,-.5),e.direction2=new BABYLON.Vector3(.5,.5,.5),e.minEmitPower=1,e.maxEmitPower=2,e.updateSpeed=.01,e.start(),this.mesh.metadata=Object.assign(Object.assign({},this.mesh.metadata),{particleSystem:e})}moveToTarget(){if(!this.targetMesh)return;let e=!0;const t=Date.now();this.scene.onBeforeRenderObservable.add((()=>{if(this.mesh&&this.mesh.physicsImpostor)if(this.mesh.rotation.x+=.05,this.mesh.rotation.y+=.05,e){const s=Date.now()-t,i=.1,o=.5,a=Math.sin(s*i)*o*1,r=new BABYLON.Vector3(a,1,.5*Math.random()-.25).normalize().scale(.7*this.speed);this.mesh.physicsImpostor.setLinearVelocity(r),s>1e3&&(e=!1)}else if(this.targetMesh){const e=this.targetMesh.position.subtract(this.mesh.position).normalize().scale(this.speed);this.mesh.physicsImpostor.setLinearVelocity(e),BABYLON.Vector3.Distance(this.mesh.position,this.targetMesh.position)<=.5&&this.hitTarget()}}))}hitTarget(){var e,t;if(console.log("🎯 Projectile a touché la cible !"),this.createHitEffect(),null===(t=null===(e=this.targetMesh)||void 0===e?void 0:e.metadata)||void 0===t?void 0:t.enemyInstance){let e=this.targetMesh.metadata.enemyInstance;e.damage(this.damageValue),e.health<=0&&this.createDeathEffect(e.mesh.position)}this.dispose()}createHitEffect(){const e=new BABYLON.ParticleSystem("hitEffect",100,this.scene);e.particleTexture=new BABYLON.Texture("textures/flare.png",this.scene),e.emitter=this.mesh.position.clone(),e.minEmitBox=new BABYLON.Vector3(-.1,-.1,-.1),e.maxEmitBox=new BABYLON.Vector3(.1,.1,.1),e.color1=new BABYLON.Color4(1,1,0,1),e.color2=new BABYLON.Color4(1,.5,0,1),e.minSize=.1,e.maxSize=.3,e.minLifeTime=.2,e.maxLifeTime=.5,e.emitRate=50,e.blendMode=BABYLON.ParticleSystem.BLENDMODE_ONEONE,e.gravity=new BABYLON.Vector3(0,-9.81,0),e.direction1=new BABYLON.Vector3(-1,-1,-1),e.direction2=new BABYLON.Vector3(1,1,1),e.minEmitPower=1,e.maxEmitPower=3,e.updateSpeed=.01,e.start(),setTimeout((()=>e.dispose()),500)}createDeathEffect(e){const t=new BABYLON.ParticleSystem("deathEffect",200,this.scene);t.particleTexture=new BABYLON.Texture("particles/28.png",this.scene),t.emitter=e,t.minEmitBox=new BABYLON.Vector3(-.5,-.5,-.5),t.maxEmitBox=new BABYLON.Vector3(.5,.5,.5),t.color1=new BABYLON.Color4(1,0,0,1),t.color2=new BABYLON.Color4(1,.5,0,1),t.minSize=.2,t.maxSize=.5,t.minLifeTime=.5,t.maxLifeTime=1,t.emitRate=100,t.blendMode=BABYLON.ParticleSystem.BLENDMODE_ONEONE,t.gravity=new BABYLON.Vector3(0,-9.81,0),t.direction1=new BABYLON.Vector3(-1,-1,-1),t.direction2=new BABYLON.Vector3(1,1,1),t.minEmitPower=2,t.maxEmitPower=5,t.updateSpeed=.01,t.start(),setTimeout((()=>t.dispose()),1e3)}dispose(){var e,t;const s=null===(e=this.mesh.metadata)||void 0===e?void 0:e.particleSystem;s&&(s.stop(),s.dispose()),null===(t=this.mesh.physicsImpostor)||void 0===t||t.dispose(),this.mesh.dispose()}}class r{constructor(e,t,s=10,i=30,a=1e3){this.target=null,this.lastShotTime=0,this.scene=e,this.range=s,this.projectileSpeed=i,this.fireRate=a,o.l.loadModel(e,"garden_tree_2",(e=>{this.mesh=e.meshes[0],this.mesh.position=t,this.mesh.scaling=new BABYLON.Vector3(2,2,2)})),setInterval((()=>{this.findTarget()}),500)}findTarget(){this.target=null;let e=this.range;i.T.forEach((t=>{if(t.mesh){const s=BABYLON.Vector3.Distance(this.mesh.position,t.mesh.position);s<e&&(e=s,this.target=t.mesh)}})),this.target&&(console.log(`Turret targeting enemy at ${this.target.position}`),this.shoot())}shoot(){const e=Date.now();e-this.lastShotTime>this.fireRate&&(new a(this.scene,this.mesh.position.clone(),this.target,this.projectileSpeed),this.lastShotTime=e)}}}}]);